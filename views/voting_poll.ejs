<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voting Poll</title>
  <!-- Base CSS -->
  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" />
  <link rel="stylesheet" href="/vendor/border-box.css" />
  <link rel="stylesheet" href="/styles/main.css" />
  <link rel="stylesheet" href="/styles/layout.css" />
  <!-- jQuery UI CSS from CDN -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <style>
    #sortable {
      list-style-type: none;
      margin: 0;
      padding: 0;
      width: 300px;
    }
    #sortable li {
      margin: 0 0 4px 0;
      padding: 8px;
      font-size: 16px;
      background-color: #F0F0F0;
      border: 1px solid #CCCCCC;
      cursor: move;
    }
  </style>
</head>
<body>
  <h1>Voting Poll Here!</h1>
  <!-- Display poll title from the DB -->
  <h2><%= poll.title %></h2>
  <p>Drag and drop the options to rank your choices:</p>

  <!-- Wrap the sortable list in a form -->
  <form id="voteForm" method="POST" action="/vote">
    <!-- Hidden field to capture the poll id -->
    <input type="hidden" name="poll_id" value="<%= poll.id %>" />

    <ul id="sortable">
      <% poll.options.forEach(function(option) { %>
        <li id="<%= option.id %>">
          <strong><%= option.title %></strong> - <%= option.description %>
        </li>
      <% }); %>
    </ul>
    <!-- Hidden input to store the ordered list -->
    <input type="hidden" name="order" id="orderInput" value="">
    <button type="submit">Submit Vote</button>
  </form>

  <!-- Include jQuery and jQuery UI -->
  <script src="/vendor/jquery-3.0.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <script>
    $(function() {
      $("#sortable").sortable();
      $("#sortable").disableSelection();

      // Before form submission, update the hidden input with the current order
      $("#voteForm").on("submit", function() {
        // Get an array of list item ids, e.g. ["1", "2", "3"]
        let order = $("#sortable").sortable("toArray");
        // Directly join them into a comma-separated string
        $("#orderInput").val(order.join(","));
      });
    });
  </script>
</body>
</html>
